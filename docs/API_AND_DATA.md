# Структура данных и API

## 1. Google Sheets (База данных)

### Лист `Users` (Персонал)
| Колонка | Описание |
| :--- | :--- |
| `ID` | Telegram ID (уникальный ключ) |
| `Name` | ФИО сотрудника |
| `Status` | `authorized` (активен) или `blocked` |
| `Contractor` | Название фирмы-подрядчика (для поиска цен) |
| `Role` | `admin` (доступ к админке) или `user` |

### Лист `Positions` (Справочник работ и Матрица цен)
| Колонка | Описание |
| :--- | :--- |
| `object_id` | ID объекта, к которому привязана работа |
| `id` | Уникальный ID позиции |
| `Наименование` | Название работы/материала |
| `unit` | Единица измерения (шт, м, м2...) |
| `client_price` | Цена для заказчика (выходная) |
| `[Название фирмы]` | Динамические колонки с ценами для конкретных подрядчиков |

### Лист `Objects` (Объекты строительства)
| Колонка | Описание |
| :--- | :--- |
| `id` | Уникальный ID объекта |
| `name` | Название объекта (отображается в приложении) |
| `address` | Адрес (опционально) |
| `is_active` | `TRUE` / `FALSE` (активен ли объект) |

### Лист `UserAssignments` (Связи Юзер-Объект)
| Колонка | Описание |
| :--- | :--- |
| `user_id` | Telegram ID пользователя |
| `object_id` | ID объекта, к которому у него есть доступ |

### Лист `Data_v2` (Журнал транзакций — История)
| Колонка | Описание |
| :--- | :--- |
| `date` | Дата и время отправки отчета |
| `user_id` | Кто отправил |
| `object_id` | На какой объект |
| `position_id` | Какую работу выполнил |
| `qty` | Количество |
| `user_rate` | Ставка подрядчика (зафиксирована на момент записи) |
| `client_price` | Цена заказчика (зафиксирована на момент записи) |
| `total_user_cost` | `qty * user_rate` |
| `total_client_cost` | `qty * client_price` |
| `margin` | Прибыль (`total_client_cost - total_user_cost`) |

---

## 2. API Эндпоинты (Google Apps Script)

### GET Запросы
*   `?userId={ID}`: Инициализация. Возвращает данные пользователя, роль и список доступных объектов.
*   `?userId={ID}&objectId={OBJ_ID}`: Возвращает отфильтрованный список работ для конкретного объекта.
*   `?userId={ID}&action=getProduction`: Возвращает суммарную выработку по всей бригаде (подрядчику).
*   `?userId={ID}&action=getUsers`: (Только для admin) Возвращает список всех пользователей.

### POST Запросы
*   `action: "sendReport"`: Записывает новые строки в `Data_v2` и отправляет отчет в Telegram.
*   `action: "addUser"`: (Admin) Создание нового пользователя.
*   `action: "updateUser"`: (Admin) Редактирование данных пользователя.
*   `action: "deleteUser"`: (Admin) Удаление пользователя.
